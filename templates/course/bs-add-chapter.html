{% extends 'bs-base.html' %}

{% block title %}
    添加章节
{% endblock %}

{% block content %}
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="{% url 'courses:course-list' %}">课程</a></li>
          <li class="breadcrumb-item"><a href="{{ course.get_absolute_url }}">{{ course }}</a></li>
          <li class="breadcrumb-item active" aria-current="page">添加章节</li>
      </ol>
    </nav>
    <div class="card border-0">
        <div class="card-body pt-0">
            <div class="card-text">
                <div class="form-group">
                    <label for="chapter-num" class="col-form-label">章节数</label>
                    <input class="form-control" id="chapter-num" placeholder="请输入阿拉伯数(1、2、3、4、5、...)">
                </div>
                <div class="form-group">
                    <label for="chapter-title" class="col-form-label">标题</label>
                    <input class="form-control" id="chapter-title" required>
                </div>
                 <div class="form-group">
                    <label for="chapter-overview" class="col-form-label">概述</label>
                    <textarea class="form-control" rows="4" id="chapter-overview"></textarea>
                </div>
            </div>
{#            <a href="http://www.markdown.cn/" target="_blank" class="card-link">概述支持Markdown语法</a>#}
            <button data-cid="{{ course.id }}"
                    class="card-link btn btn-outline-success float-right add-chapter">
                <i class="fa fa-paper-plane-o" aria-hidden="true"></i> 提交
            </button>
        </div>
    </div>
{% endblock %}

{% block js %}
    <script type="text/javascript">
        $('button.add-chapter').click(function () {
            var re = /^[0-9]+.?[0-9]*/;
            var chapter_num = $.trim($('input#chapter-num').val());
            if (!re.test(chapter_num)){
                tips('请确认"章数"认输入类型为阿拉伯数字', 'danger');
                return false;
            }
            var chapter_title = $.trim($('input#chapter-title').val());
            var chapter_overview = $.trim($('textarea#chapter-overview').val());
            if (chapter_num == '' || chapter_title == '' || chapter_overview == ''){
                tips('章节数、标题、概述都不能为空', 'danger');
                return false;
            }
            var cid = $(this).data('cid');

            $.ajax({
                cache: false,
                type: 'POST',
                url: '/course/add/chapter/',
                data: {'cid': cid, 'cnum': chapter_num, 'title': chapter_title, 'overview': chapter_overview},
                async: true,
                success: function (data) {
                    if (data.msg == 'ok'){
                        tips('添加成功，页面即将刷新~', 'success');
                        setTimeout(function () {
                            location.reload();
                        }, 1500);
                        return true;
                    }
                    if (data.msg == 'repeat'){
                        tips('章节数已经存在~', 'danger');
                        return false;
                    }
                    if (data.msg == 'ko'){
                        tips('哎呀，出错了， 请刷新后重试', 'danger');
                        return false;
                    }
                }
            })
        });
    </script>
{% endblock %}