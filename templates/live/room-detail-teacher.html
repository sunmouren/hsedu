{% extends 'base-blank.html' %}

{% load static %}


{% block title %}
    课程直播 - 教师端
{% endblock %}


{% block content %}
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
          <li class="breadcrumb-item"><a class="card-link" href="{{ course.get_absolute_url }}">退出直播</a></li>
          <li class="breadcrumb-item active" aria-current="page">{{ course }} - 课程直播</li>
      </ol>
    </nav>
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
        <strong>友情提示：本功能尚在处于测试阶段, 正式版我们将提供直播回放、合流学生端屏幕共享等功能。</strong>
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="live-play" id="local-player">

    </div>
{% endblock %}


{#{% block js %}#}
{#    <script type="text/javascript" src='{% static 'live/js/pili-rtc-web.js' %}'></script>#}
{#    <script type="text/javascript">#}
{#        const roomToken = "{{ room_token }}";#}
{#        const myRTC = new QNRTC.StreamModeSession();#}
{#        (async () => {#}
{#            try {#}
{#                // 调用 SDK 加入房间#}
{#                const users = await myRTC.joinRoomWithToken(roomToken);#}
{#                // 加入房间成功后注册事件，当页面被关闭就离开房间#}
{#                window.onbeforeunload = () => {#}
{#                    myRTC.leaveRoom();#}
{#                };#}
{#                // 检查chrome录屏插件是否安装#}
{#                isChromeExtensionAvailable().then(isAvailable => {#}
{#                    if (!isAvailable) {#}
{#                        console.log("插件异常！");#}
{#                    }#}
{#                });#}
{##}
{##}
{#                // 采集本地媒体流，视频和音频都采集#}
{#                const localStream = await QNRTC.deviceManager.getLocalStream({#}
{#                    screen: {#}
{#                        enabled: true,#}
{#                        source: "screen",#}
{#                        bitrate: 600,#}
{#                        height: 1080,#}
{#                        width: 1920,#}
{#                    },#}
{#                    audio: {#}
{#                        enabled: true,#}
{#                    }#}
{#                });#}
{##}
{#                // 获取我们 room.html 中准备用来显示本地媒体流的元素#}
{#                const localPlayer = document.getElementById('local-player');#}
{#                // 调用媒体流的 play 方法，在我们指定的元素上播放媒体流，其中第二个参数代表 静音播放#}
{#                localStream.play(localPlayer, true);#}
{#                // 发布刚刚采集到的媒体流到房间#}
{#                await myRTC.publish(localStream);#}
{#                console.log('publish success!');#}
{##}
{#            } catch (e) {#}
{#                console.log('error!', e);#}
{#            }#}
{##}
{#        })();#}
{#    </script>#}
{#{% endblock %}#}